<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
    <div>
        <h2>Formulário de Certificado de Garantia</h2>
        <form id="certificadoForm">
            <div class="form-group">
                <label for="codigopedido">Código do Pedido:</label>
            <div style="display: flex; align-items: center;">
                <input type="text" id="codigopedido" placeholder="Digite o código do pedido" max="99999999">
                <button id="buscarPedido" style="margin-left: 10px;">Buscar</button>
            </div>
            </div>
            
            <div class="form-group">
                <label for="os">Ordem de serviço:</label>
                <input type="text" id="os" placeholder="Digite a ordem de serviço" max="99999">
            </div>

            <div class="form-group">
                <label for="nome">Nome do Cliente:</label>
                <input type="text" id="nome" placeholder="Digite o nome do cliente" pattern="[A-Za-zÀ-ÿ\s]+" maxlength="27">
            </div>
            <div class="form-group">
                <label for="nomeLente">Nome da Lente:</label>
                <select id="nomeLente">
                    <option value="CLARA">Clara</option>
                    <option value="CLARA PREMIUM">Clara Premium</option>
                </select>
            </div>
            <div class="form-group">
                <label for="sensity">Possui Sensity:</label>
                <select id="sensity">
                    <option value="NÃO">Não</option>
                    <option value="TRANSLIGHT">Sensity</option>
                </select>
            </div>
            <div class="form-group">
                <label for="material">Material:</label>
                <select id="material">
                    <option value="150">1.50</option>
                    <option value="TRIVEX">Trivex</option>
                    <option value="POLI">Poli</option>
                    <option value="167">1.67</option>
                    <option value="174">1.74</option>
                </select>
            </div>
            <div class="form-group">
                <label for="tratamento">Tratamento:</label>
                <select id="tratamento">
                    <option value="ECO CLEAN">Cleanextra</option>
                    <option value="ECO FORTIS">No risk</option>
                    <option value="ECO FORTIS BLUE">No risk + bluecontrol</option>
                    <option value="ECO BLUE">Bluecontrol</option>
                    <option value="ECO INFINITY">Longlife</option>
                </select>
            </div>
            <h3>Inserir Grau</h3>
            <table>
                <thead>
                    <tr>
                        <th></th>
                        <th>ESF</th>
                        <th>CIL</th>
                        <th>EI</th>
                        <th>DNP</th>
                        <th>ADD</th>
                        <th>CO</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>OD</strong></td>
                        <td><input type="number" id="esfericoOD" placeholder="ESF" step="0.25"></td>
                        <td><input type="number" id="cilindricoOD" placeholder="CIL" step="0.25"></td>
                        <td><input type="number" id="eixoOD" placeholder="E" min="1" max="180"></td>
                        <td><input type="number" id="dnpOD" placeholder="DNP" step="0.25" min="10" max="50"></td>
                        <td><input type="number" id="addOD" placeholder="ADD" step="0.25" min="0.25" max="3.50"></td>
                        <td><input type="number" id="coOD" placeholder="CO" min="10" max="40"></td>
                    </tr>
                    <tr>
                        <td><strong>OE</strong></td>
                        <td><input type="number" id="esfericoOE" placeholder="ESF" step="0.25"></td>
                        <td><input type="number" id="cilindricoOE" placeholder="CIL" step="0.25"></td>
                        <td><input type="number" id="eixoOE" placeholder="Ei" min="1" max="180"></td>
                        <td><input type="number" id="dnpOE" placeholder="DNP" step="0.25" min="10" max="50"></td>
                        <td><input type="number" id="addOE" placeholder="ADD" step="0.25" min="0.25" max="3.50"></td>
                        <td><input type="number" id="coOE" placeholder="CO" min="10" max="40"></td>
                    </tr>
                </tbody>
            </table><br>

            <div class="form-group">
                <label for="medico">Nome do Médico:</label>
                <input type="text" id="medico" placeholder="Digite o nome do médico" pattern="[A-Za-zÀ-ÿ\s]+" maxlength="50">
            </div>
            <div class="form-group">
                <label for="otica">Nome da Ótica:</label>
                <select id="otica">
                    <option value="ARCOVERDE">Arcoverde</option>
                    <option value="ARCOVERDE EMPRESARIAL">Arcoverde Empresarial</option>
                    <option value="ARCOVERDE AVENIDA">Arcoverde Avenida</option>
                    <option value="ARCOVERDE TRADE">Arcoverde Trade</option>
                    <option value="STILLUS">Stillus</option>
                    <option value="CARUARU MATRIZ">Caruaru Matriz</option>
                    <option value="CARUARU SANTA CRUZ">Caruaru Santa Cruz</option>
                    <option value="ARCOVERDE SANTA CRUZ">Arcoverde Santa Cruz</option>
                </select>
            </div>
            <div class="form-group">
                <label for="data">Data:</label>
                <input type="date" id="data">
            </div>
            <button type="button">Gerar Certificado de Garantia</button>

        </form>
        
        <div id="certificado"></div>
    </div>
    <script>
        document.getElementById("buscarPedido").addEventListener("click", async function () {
            const pedidoId = document.getElementById("codigopedido").value.trim(); // Pega o valor do campo de código do pedido
        
            if (!pedidoId) {
                alert("Por favor, insira um número de pedido válido.");
                return;
            }
        
            const url = `https://tst.hoyalabhomologa.com.br/api/pedido/${pedidoId}`; // Endpoint da API
        
            try {
                const response = await fetch(url, {
                    method: "GET",
                    headers: {
                        "Authorization": "vW21QNBbKE235+++XU0CHNJvoZsThXYJMkE3RjkuM4U=", // Substitua pelo token correto
                        "Content-Type": "application/json"
                    }
                });
        
                if (!response.ok) {
                    throw new Error(`Erro ao buscar pedido: ${response.status}`);
                }
        
                const data = await response.json(); // Converte a resposta para JSON
                preencherFormulario(data); // Chama a função para preencher o formulário
            } catch (error) {
                console.error("Erro:", error);
                alert("Não foi possível buscar o pedido. Verifique o número e tente novamente.");
            }
        });
        
        // Função para preencher o formulário com os dados obtidos
        function preencherFormulario(data) {
            document.getElementById("nome").value = data.nome_cliente || "";
            document.getElementById("nomeLente").value = data.nome_lente || "CLARA";
            document.getElementById("sensity").value = data.sensity || "NÃO";
            document.getElementById("material").value = data.material || "150";
            document.getElementById("tratamento").value = data.tratamento || "ECO CLEAN";
            document.getElementById("esfericoOD").value = data.grau_od.esferico || 0;
            document.getElementById("cilindricoOD").value = data.grau_od.cilindrico || 0;
            document.getElementById("eixoOD").value = data.grau_od.eixo || 0;
            document.getElementById("dnpOD").value = data.grau_od.dnp || 0;
            document.getElementById("addOD").value = data.grau_od.adicao || 0;
            document.getElementById("coOD").value = data.grau_od.co || 0;
            document.getElementById("esfericoOE").value = data.grau_oe.esferico || 0;
            document.getElementById("cilindricoOE").value = data.grau_oe.cilindrico || 0;
            document.getElementById("eixoOE").value = data.grau_oe.eixo || 0;
            document.getElementById("dnpOE").value = data.grau_oe.dnp || 0;
            document.getElementById("addOE").value = data.grau_oe.adicao || 0;
            document.getElementById("coOE").value = data.grau_oe.co || 0;
            document.getElementById("medico").value = data.nome_medico || "";
            document.getElementById("otica").value = data.otica || "ARCOVERDE";
            document.getElementById("data").value = data.data_pedido || "";
        }
        </script>
</html>